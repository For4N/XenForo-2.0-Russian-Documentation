# <a name="part0"></a>Основы маршрутизации
В PHP-приложении, таком как XF2, нам нужен способ принять запрос пользователя на определенный URL-адрес, понять, какой контроллер, действие и какие данные представляет этот URL-адрес, чтобы представить соответствующий ответ пользователю. Концепция преобразования URL-адреса в местоположение в коде известна как "маршрутизация"(routing).

В XF2 маршрутизация почти полностью управляется из ACP(панель администратора). Найти его можно по пути `ACP > Development > Routes`. Маршруты делятся на два типа, Public(Публичный) и Admin(Админ) они обеспечивают маршрутизацию запросов в приложениях Public и Admin соответственно.

# <a name="part1"></a>Простой пример
На странице маршрутов (см. выше), вы должны увидеть маршрут `account/`. Это Public маршрут, обеспечивающий маршрутизацию запросов к URL-адресу `index.php?account/`. Этот маршрут довольно простой; он состоит только из небольшого количества конфигураций. Notably, Он состоит из "префикса маршрута"(Route prefix), "контекста раздела"(section context) и класса контроллера(controller class). Давайте разберемся в этом более подробно:

### <a name="part2"></a>Префикс маршрута

Префикс маршрута идёт после `index.php?` и перед первым `/`. Это-первый шаг в определении, к какому контроллеру направить запрос.

### <a name="part3"></a>Раздел контекста

Контекст раздела сообщает навигационным системам в XF, какой вкладка навигации должна быть выбрана, когда посетитель просматривает страницу, направленную по этому маршруту. Для `Public` маршрутов контекст раздела должен быть идентификатором вкладки верхнего уровня. Для маршрутов `Admin` это должно обратиться к идентификатору самой вкладки навигации администратора (независимо от глубины).

В случае с маршрутом `index.php?account/`, контекст раздела не обязателен, поскольку у нас нет вкладки навигации "account". Но, чтобы увидеть это в действии, просто измените значение "контекст раздела" здесь на "forums", сохраните изменения и перейдите в свою учетную запись `index.php?account/`. Теперь вы должны увидеть, что выбрана вкладка навигации "форумы"!

### <a name="part4"></a>Контроллер

Это имя класса контроллера, которое должно быть вызвано, когда запрос совпадает с этим маршрутом. В случае с маршрутом "account/", у нас есть `XF:Account`. Это загрузит контроллер учетной записи. (Смотрите [Короткие имена классов](/documentation/GeneralConcepts.md#part5) для дополнительной информации). Код этого контроллера располагается по этому пути `src/XF/Pub/Controller/Account.php`. Notice how short class names are able to resolve to an "infix" as well as a prefix (XF) and a suffix (Account). In this case, the infix for this controller (Pub) is inferred from the Account route type (public).

### <a name="part5"></a>Экшен контроллера

Выше мы объяснили, как маршрут сопоставляется с определенным контроллером, но мы еще не знаем, как вызывается определенное действие в этом контроллере. Контроллеры являются классами, которые содержат ряд методов, и часть URL после [префикса маршрута](/documentation/RoutingBasics.md#part2) указывает на действие контроллера. Данный URL `index.php?account/account-details`, вызывает класс контроллера `XF\Pub\Controller\Account` с именем метода `actionAccountDetails()`. Если маршрут не указывает действие, то вызывается метод `actionIndex()`.

Вы можете больше узнать о контроллерах в разделе [Основы контроллера](/documentation/ControllerBasics.md#part0).

### <a name="par6t"></a>Более продвинутый пример (форматы маршрута)

Давайте посмотрим на маршрут `members/`. Этот маршрут простой, также как и маршрут `account/`, но у него есть дополнительное поле; "формат маршрута"(Route format). Чтобы понять, как это работает, посмотрите на свой профиль. URL этого профиля будет выглядеть примерно так `index.php?members/your-name.1`. В частности, обратите внимание на `your-name.1`. Это та часть, которую мы пытаемся сопоставить, используя "формат маршрута".

"Формат маршрута" позволяет нам извлекать данные из URL запроса, так мы можем передать данные в действие контроллера, чтобы оно могло загрузить определенную информацию; в этом случае загружается профиль запрошенного пользователя. Это также помогает нам создавать ссылки из передаваемых данных. Вот синтаксис:
```
:int<user_id,username>/:page
```

Интересно отметить, что важной частью URL-адреса профиля для поиска профиля является не `your-name`, а идентификатор пользователя (`1`). Чтобы продемонстрировать это, измените часть URL `your-name` на `not-your-name`.Вы увидите, что правильный профиль найден, и перенаправление выполнено к правильному URL.

Приведенный выше формат указывает, что это целочисленный параметр. Для построения исходящей ссылки мы извлекаем целое число из ключа `user_id` передаваемых данных. Если ключ имени пользователя передается в данные, он будет "слагифицирован" и добавлен к целочисленному идентификатору, как вы видите в URL-адресе вашего профиля. Для сопоставления входящего URL-адреса это преобразуется в регулярное выражение, соответствующее целочисленному формату параметра.

`:page` это ярлык для генерации части ссылки на странице-123. В этом случае он ищет страницу в параметрах ссылки. Если он найден, он помещается в URL-адрес, а затем удаляется из параметров. Для входящего парсинга, если он совпадает (он может быть пустым), добавит номер страницы к параметрам, передаваемым в контроллер.

### <a name="part7"></a>Параметры маршрута

Когда маршрут совпадает с определенным контроллером и действием, любые параметры в URL-адресе обернуты в специальный объект, который мы называем `ParameterBag`. Этот объект специально разработан, чтобы отделить обычные параметры URL с теми, которые прибывают из соответствия маршрута. Объект `ParameterBag` передается в каждое действие контроллера и используется следующим образом:
```
$userId = $params->user_id;
```

### <a name="part8"></a>Суб-имена

Также можно разделять маршруты на дополнительные суб-имена. Вы можете увидеть это в действии, глядя на маршрут `members/following`. В этом примере, `following` является ли ссуб-именем маршрута `members`. Обычно URL-адрес выглядит следующим образом `index.php?members/following`, где часть `following` будет указывать на действие и просто соответствовать нормальному маршруту `members/`. Однако, если есть маршрут, который соответствует префиксу «members» и «sub-name», указанному ниже, он будет использоваться вместо этого. Это верно здесь, поэтому он создает ссылку, как показано ниже:
```
members/:int<user_id,username>/following/:page
```

Для сопоставления входящего маршрута этот маршрут будет протестирован перед маршрутом `members`; если он совпадает, он будет использоваться.

Эта система суб-имён позволяет изменять поведение, например, изменять положение параметров или подгруппировать маршруты на разных контроллерах или с разными параметрами. Пример последнего можно увидеть в менеджере ресурсов и надстройках Media Gallery.
