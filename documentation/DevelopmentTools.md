# <a name="part0"></a>Инструменты разработки
XF2 предоставляет разработчикам ряд встроенных инструментов, которые вы можете использовать для ускорения разработки плагинов, и мы рассмотрим некоторые из них ниже.

## <a name="part1"></a>Режим отладки
Режим отладки может быть включен в вашем `config.php`, который позволит вам получить доступ к определенным инструментам разработки в ACP (например, создавать маршруты, разрешения, административную навигацию  и т.д.), А также будет включать отладочную информацию в нижней части каждой страницы в котором подробно описывается, сколько времени потребовалось для обработки страницы, сколько запросов было выполнено для отображения страницы и количества памяти. Всплывающая подсказка, содержащая информацию о текущем контроллере, экшене и имени шаблона, доступна при наведении. Вы также можете нажать на вывод времени, и это даст вам подробный обзор того, какие запросы выполнялись, и трассировка стека, которая привела к выполнению этого запроса.

Вы можете включить режим отладки, добавив следующую строку в `config.php`:

    $config['debug'] = true;

## <a name="part2"></a>Включение режима разработки
Режим разработки - это специальный режим, активированный в файле `config.php`, который заставит XF автоматически записывать ваши действия при разработке в ваш каталог` _output`. Этот режим должен быть включен для включения редактирования шаблона файловой системы. Поскольку режим разработки будет записывать файлы в вашу файловую систему, важно убедиться, что у вас есть соответствующие права доступа к файлам. Это может варьироваться в зависимости от среды, но типичная конфигурация будет заключаться в том, чтобы убедиться, что для любого плагина, над которым вы работаете, у вас есть _output-каталог и установленный chmod на `0777`. Например, если вы работаете над плагином с идентификатором «Demo», его вывод разработки будет выписан в `src/addons/Demo/_output`, и поэтому этот каталог должен быть полностью доступен для записи.

Включение режима разработки также позволяет включить [режим отладки](/documentation/DevelopmentTools.md#part1) автоматически.

Чтобы включить режим разработки, добавьте следующие строки в файл `config.php`:

    $config['development']['enabled'] = true;
    $config['development']['defaultAddOn'] = 'SomeCompany/MyAddOn';

Значение `defaultAddOn` является необязательным, но добавление будет автоматически заполнять указанное дополнение в ACP при создании нового содержимого, которое будет связано с плагином.

В дополнение к вышесказанному, вам может потребоваться добавить дополнительную конфигурацию, особенно если вы используете более одной установки XF.

    $config['enableMail'] = false;

Это отключит отправку всей почты с вашей установки XF. Это особенно важно, если вы используете копию живых данных с реальными пользователями и реальными адресами электронной почты (хотя мы бы ее советовали этого!).

В качестве альтернативы отключению почты напрямую вы можете по желанию использовать такую услугу, как [MailTrap.io](https://mailtrap.io/). Это дает вам бесплатный почтовый ящик, который будет получать все электронные письма, отправленные с вашей установки XF, что очень полезно для тестирования любых электронных писем, которые может отправлять ваше новое дополнение.

    $config['cookie']['prefix'] = 'anything_';

Если вы используете две или более установки XF в одном домене, могут возникнуть проблемы с перезаписыванием файлов cookie, вызванные установками, использующими один и тот же префикс cookie. Поэтому рекомендуется убедиться, что вы изменили префикс cookie для каждой установленной вами установки XF. Без этого вы столкнетесь с проблемами, например, при выходе из одной установки XF при входе в другую.

## <a name="part3"></a>Команды разработки
XF 2.0 поставляется с несколькими стандартными командами CLI и плагинами, которые направлены на то, чтобы помочь вам развиваться более эффективно или даже, возможно, автоматизировать/запустить некоторые обычные процессы.

В этом разделе мы рассмотрим некоторые общие инструменты и объясним, что они делают.

## <a name="part4"></a>Дополнительные команды плагинов
### <a name="part5"></a>Создание нового плагина
    $ php cmd.php xf-addon:create

Команда `xf-addon: create` позволяет создать и настроить новое дополнение. Вам следует ответить на следующие вопросы, - это основные вопросы:

* Введите идентификатор (ID) этого дополнения
* Введите название
* Введите идентификатор версии (ID) (т.е. 1000010)
* Введите строку версии (т.е. 1.0.0 Alpha)

Затем вам будет предоставлена возможность создать плагин и файл addon.json в его каталоге и заданы некоторые вопросы о том, хотите ли вы добавить файл Setup.php.

### <a name="part6"></a>Экспорт .XML файлов _data
    $ php cmd.php xf-addon:export [addon_id]

Эта команда предназначена для экспорта всех данных вашего плагина в файлы XML внутри каталога `_data`. Он экспортирует данные из того, что в настоящее время находится в базе данных (а не из выходных файлов разработки).

### <a name="part7"></a>Повышение версии плагина
    $ php cmd.php xf-addon:bump-version [addon_id] --version-id 1020370 --version-string 1.2.3

Эта команда позволяет изменить идентификатор и строку версии без необходимости обновления плагина. Вышеуказанные опции являются необязательными, и если они не предоставлены, вам будет предложено указать их. Если вы укажете только идентификатор версии, мы попытаемся вывести правильную строку версии из этого автоматически, если она соответствует нашей [Рекомендации к строковому формату версии](/documentation/AddOnStructure.md#part2). По завершении команды он автоматически обновляет файл `addon.json` и базу данных с правильной информацией о версии.

### <a name="part8"></a>Синхронизация addon.json с базой данных
    $ php cmd.php xf-addon:sync-json [addon_id]

Иногда вы можете отредактировать файл JSON напрямую с определенными деталями. Это может быть версия, или новый значок, или изменение названия или описания. Таким образом, изменение JSON может привести к тому, что плагин будет полагать, что есть ожидающие изменения или что плагин является обновляемым. Восстановление или обновление могут вызвать проблемы (например, потеря данных), если вы еще не экспортировали свои текущие данные. Поэтому выполнение этой команды рекомендуется как способ импорта этих данных, не затрагивая ваши существующие данные.

### <a name="part9"></a>Проверка файла addon.json
    $ php cmd.php xf-addon:validate-json [addon_id]

Эта команда позволяет вам проверить, что ваш JSON-файл содержит правильное содержимое и в правильном формате. Валидатор проверяет, может ли контент быть декодирован, что он содержит все необходимые поля (например, название и идентификатор версии), а также проверяет наличие дополнительных ключей (например, описание и значок). Если какие-либо ключи отсутствуют, вам будут предложены исправления. Мы также проверяем, есть ли какие-либо неожиданные поля в файле JSON. Они могут быть преднамеренными или представлять опечатки. Вы можете запустить команду вручную, или команда будет запущена автоматически при создании вашей версии.

### <a name="part10"></a>Запустить отдельный шаг установки
Иногда бывает полезно проверить правильность шагов вашего класса установки, не выполняя процесс удаления и переустановки.

Есть три команды, которые помогают в этом. Эти команды будут работать только с классами Setup, которые создаются с использованием стандартных параметров `StepRunner`.

#### <a name="part11"></a>Запустить шаг установки
    $ php cmd.php xf-addon:install-step [addon_id] [step]

#### <a name="part12"></a>Запустить шаг обновления
    $ php cmd.php xf-addon:upgrade-step [addon_id] [version] [step]

#### <a name="part13"></a>Запустить шаг удаления
    $ php cmd.php xf-addon:uninstall-step [addon_id] [step]

## <a name="part14"></a>Выпуск сборки плагина
После того, как все тяжелые работы были выполнены, стыдно, что вам нужно пройти через ряд других процессов, прежде чем вы сможете их освободить. Даже процесс сбора всех файлов в нужном месте и создания файла ZIP вручную может занять много времени и подвержен ошибкам. Мы можем позаботиться об этом автоматически, включая создание файла hashes.json, с помощью одной простой команды.

    $ php cmd.php xf-addon:build-release [addon_id]

Когда вы запустите эту команду, сначала запустся команда «xf-addon: export», а затем соберет все ваши файлы во временный каталог `_build` и запишет их в ZIP-файл. Готовый ZIP также будет содержать файл `hashes.json`. Как только ZIP будет создан, он будет сохранен в вашем каталоге `_releases` и называется `<ADDON ID> - <VERSION STRING>.zip`.

### <a name="part15"></a>Расширенный процесс сборки
Помимо создания ZIP-файла выпуска могут быть дополнительные файлы, которые вы хотите включить в свои ZIP-архивы, другие более сложные процессы сборки, которые вы хотите запустить, например, для минимизации или конкатенации JS или выполнения определенных команд оболочки. Все это можно позаботиться в файле `build.json`. Это типичный файл `build.json`:
```json
{
    "additional_files": [
        "js/demo/portal"
    ],
    "minify": [
        "js/demo/portal/a.js",
        "js/demo/portal/b.js"
    ],
    "rollup": {
        "js/demo/portal/ab-rollup.js": [
            "js/demo/portal/a.min.js",
            "js/demo/portal/b.min.js"
        ]
    },
    "exec": [
        "echo '{title} version {version_string} ({version_id}) has been built successfully!' > 'src/addons/Demo/Portal/_build/built.txt'"
    ]
}
```
Если у вас есть скрипты, такие как JavaScript, которые необходимо обслуживать вне вашего каталога плагина, вы можете сообщить процессу сборки для копирования файлов или каталогов с помощью массива `Additional_files` в` build.json`. Во время разработки не всегда возможно хранить файлы вне вашего каталога плагина, поэтому, если вы предпочитаете, вы можете сохранить файлы в своем каталоге плагина `_files`. При копировании дополнительных файлов мы сначала проверим их.

Если вы отправляете некоторые JS-файлы с плагином, возможно, вы захотите минимизировать эти файлы по соображениям производительности. Вы можете указать, какие файлы вы хотите минимизировать прямо внутри `build.json`. Вы можете перечислить их как массив или просто указать его как `*`, который будет просто уменьшать все в вашем каталоге js, если этот путь содержит JS-файлы в нем после копирования дополнительных файлов в сборку. В любом файле, который был изменен, автоматически будет иметь суффикс `.min.js` вместо` .js`, и исходные файлы все равно будут находиться в пакете.

Вы можете сгрупировать несколько JS-файлов в один файл. Если вы это сделаете, вы можете использовать массив `rollup` для определения этого. Ключ - это итоговое комбинированное имя файла, а элементы внутри этого массива - это пути к файлам JS, которые будут объединены в один файл.

Наконец, у вас могут быть определенные процессы, которые необходимо запустить непосредственно перед тем, как пакет будет построен и завершен. Это может быть любая комбинация вещей. В конечном счете, если это команда, которую можно запустить из оболочки (включая скрипты PHP), вы можете указать ее здесь. Вышеприведенный пример, конечно, бесполезен, но, по крайней мере, демонстрирует, что можно использовать некоторые заполнители. Эти заполнители заменяются скалярными значениями, которые вы можете получить из объекта `XF\AddOn\AddOn`, который обычно представляет собой любое значение, доступное в файле` addon.json`, или `AddOn`.

## <a name="part16"></a>Команды разработки
На самом деле существует довольно много команд, связанных с развитием, но здесь рассматриваются только два самых важных.

Чтобы использовать любую из этих команд, вы должны иметь [development mode](/documentation/DevelopmentTools.md#part2) включен в файле `config.php`.

> **Предупреждение**
> Both of the following commands can potentially cause data loss if there is a situation whereby the database and `_output` directory become out of sync. It is always recommended to use a VCS (Version Control System) such as [GitHub](https://github.com/) to mitigate the impact of such mistakes.

### <a name="part17"></a>Импорт вывода разработки
    $ php cmd.php xf-dev:import --addon [addon_id]

Выполнение этой команды будет импортировать все выходные файлы разработки из вашего дополнительного каталога `_output` в базу данных.

### <a name="part18"></a>Экспорт вывода разработки
    $ php cmd.php xf-dev:export --addon [addon_id]

This will export all data currently associated to your add-on in the database to files within your `_output` directory.

## <a name="part19"></a>Отладка кода
Для работы с XF2 должно быть возможно настроить ваш любимый инструмент отладчика (XDebug, Zend Debugger и т.д.). Хотя иногда код отладки может быть как рудиментарным, так и быстро видимым, какое значение (или тип значения) хранится в переменной в данный момент времени.

### <a name="part20"></a>Отладка переменной
PHP of course has a tool built-in to handle this. You'll likely know it as `var_dump()`. XF ships with two replacements for this:

    \XF::dump($var);
    \XF::dumpSimple($var);
The simple version mostly just dumps out the value of a variable in plain text. For example, if you just use it to dump the value of an array, you will see an output at the top of the page like this:

    array(2) {
        ["user_id"] => int(1)
        ["username"] => string(5) "Admin"
    }
This is actually the same output as a standard var_dump, but slightly modified for readability and wrapped inside `<pre>` tags to ensure whitespace is maintained when rendering.

The alternative is actually a component named VarDumper from the Symfony project. It outputs HTML, CSS and JS to create a much more functional and potentially easier to read output. It allows you to collapse certain sections, and for certain values which can output a considerable amount of data, such as objects, it can collapse those sections automatically.
